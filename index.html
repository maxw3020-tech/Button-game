<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Button Game</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Press Start 2P', monospace;
      color: #e8dcb9;
      image-rendering: pixelated;
      transition: background-image 0.5s ease-in-out;
      position: relative;
      background: none;
    }

    #game {
      width: 100vw;
      height: 100vh;
      position: relative;
      z-index: 2;
      opacity: 0;
      transition: opacity 1s ease-in-out;
    }

    #header {
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: center;
      z-index: 10;
      font-size: 14px;
      text-shadow: 2px 2px #000;
    }

    #levelDisplay {
      position: absolute;
      top: 60px;
      width: 100%;
      text-align: center;
      z-index: 10;
      font-size: 14px;
      text-shadow: 2px 2px #000000;
    }

    #timer {
      position: absolute;
      top: 90px;
      width: 100%;
      text-align: center;
      z-index: 10;
      font-size: 14px;
      text-shadow: 2px 2px #000;
    }

    .gameButton {
      position: absolute;
      cursor: pointer;
      width: 90px;
      height: 90px;
      border: none;
      background: url('redbutton.png') no-repeat center/contain;
      transition: transform 0.2s;
      z-index: 5;
    }

    .gameButton:hover {
      transform: scale(0.8);
    }

    #videoOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 4;
    }

    #videoOverlay video {
      max-width: 80vw;
      max-height: 80vh;
    }

    #startMenu {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      flex-direction: column;
      overflow: hidden;
    }

    #startBackground {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('startmenubackground.gif');
      background-size: cover;
      background-position: center;
      filter: blur(3px);
      z-index: 1;
    }

    #startButton {
      width: 300px;
      height: 300px;
      background: url('start.png') no-repeat center/contain;
      cursor: pointer;
      border: none;
      z-index: 10;
      transition: transform 0.2s;
      display: none;
    }

    #startButton:hover {
      transform: scale(0.9);
    }

    #exitButton {
      position: fixed;
      top: 5px;
      right: 20px;
      width: 100px;
      height: 100px;
      background: url('exit.png') no-repeat center/contain;
      cursor: pointer;
      z-index: 15;
      border: none;
      transition: transform 0.2s;
    }

    #exitButton:hover {
      transform: scale(1.1);
    }

    #readSign {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 150px;
      height: 150px;
      background: url('read.png') no-repeat center/contain;
      cursor: pointer;
      z-index: 10;
      animation: swing 2s infinite alternate;
    }

    #readPopup {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      width: 1000px;
      height: 1000px;
      background: url('read2.png') no-repeat center/contain;
      display: none;
      z-index: 11;
      animation: popup 0.5s forwards;
    }

    #instructionText {
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      text-align: center;
      color: #000000;
      font-size: 16px;
      z-index: 12;
      display: none;
    }

    #levelInput {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
      padding: 10px;
      display: none;
      z-index: 20;
    }

    @keyframes swing {
      0% { transform: rotate(-10deg); }
      50% { transform: rotate(10deg); }
      100% { transform: rotate(-10deg); }
    }

    @keyframes popup {
      0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }

  </style>
</head>
<body>

  <div id="startMenu">
    <div id="startBackground"></div>
    <div id="readSign"></div>
    <div id="readPopup"></div>
    <div id="instructionText"></div>
    <button id="startButton"></button>
  </div>

  <button id="exitButton"></button>

  <div id="game">
    <div id="header">
      <div>Click the Red Button</div>
      <div id="headerInstructions">Click on the Red Buttons as fast as you can. You got 20 seconds to finish. There are 10 levels.</div>
    </div>
    <div id="levelDisplay">Level: 1</div>
    <div id="timer">Time: 20s</div>
  </div>

  <input type="text" id="levelInput" placeholder="Type the letters in order" />

  <div id="videoOverlay">
    <video id="prankVideo" src="AHHAHA.mp4"></video>
  </div>

  <script>
    let level = 1;
    const totalLevels = 10;
    const backgroundGifs = [
      '1background.gif','2background.gif','3background.gif','4background.gif','5background.gif',
      '6background.gif','7background.gif','8background.gif','9background.gif','10background.gif'
    ];

    const overlay = document.getElementById('videoOverlay');
    const video = document.getElementById('prankVideo');
    const startMenu = document.getElementById('startMenu');
    const startButton = document.getElementById('startButton');
    const exitButton = document.getElementById('exitButton');
    const gameDiv = document.getElementById('game');
    const levelDisplay = document.getElementById('levelDisplay');
    const timerDisplay = document.getElementById('timer');
    const readSign = document.getElementById('readSign');
    const readPopup = document.getElementById('readPopup');
    const instructionText = document.getElementById('instructionText');
    const headerInstructions = document.getElementById('headerInstructions');
    const levelInput = document.getElementById('levelInput');

    let timeLeft = 20;
    let timerInterval;

    // Add looping prank audio
    const prankLoopAudio = new Audio('maon.mp3');
    prankLoopAudio.loop = true;

    function updateBackground() {
      if(level <= totalLevels) {
        document.body.style.backgroundImage = `url('${backgroundGifs[level-1]}')`;
        document.body.style.backgroundSize = 'cover';
        document.body.style.backgroundPosition = 'center';
        document.body.style.backgroundRepeat = 'no-repeat';
      }
    }

    function playPrank() {
      const audio = new Audio(`alpha${level}.mp3`);
      audio.play();
      overlay.style.display = 'flex';
      video.play();
      prankLoopAudio.play(); // start looping maon.mp3
    }

 function spawnButton() {
  const btn = document.createElement('button');
  btn.className = 'gameButton';
  const maxX = window.innerWidth - 90;
  const maxY = window.innerHeight - 90;
  btn.style.left = Math.random() * maxX + 'px';
  btn.style.top = Math.random() * maxY + 'px';

  btn.addEventListener('click', () => {
    const audio = new Audio(`alpha${level}.mp3`);
    audio.play();
    btn.remove();

    if (level < totalLevels) {
      level++;
      levelDisplay.textContent = 'Level: ' + level;
      updateBackground();
      spawnButton();
    } else {
      clearInterval(timerInterval);   // <<< STOP THE TIMER HERE
      timerDisplay.style.display = 'none';
      levelInput.style.display = 'block';
      levelInput.focus();
    }
  });

  gameDiv.appendChild(btn);
}

    function startTimer() {
      timerInterval = setInterval(() => {
        timeLeft--;
        timerDisplay.textContent = `Time: ${timeLeft}s`;
        if(timeLeft <= 0){
          clearInterval(timerInterval);
          exitButton.click();
        }
      }, 1000);
    }

readSign.addEventListener('click', () => {
  readPopup.style.display = 'block';
  readPopup.style.animation = 'popup 0.5s forwards';
  instructionText.innerHTML = ''; // start empty
  instructionText.style.display = 'block';

  const instructions = [
    'Klicka på de röda knapparna så',
    'snabbt du kan. Du har 20 sekunder',
    'Det finns totalt 10 nivåer att klara.',
    'På sista nivån måste du',
    'skriva bokstäverna i ordning. Hör ljudet',
    'noggrant för att följa alfabetet. Sätt',
    'volymen på max för att höra alla',
    'bokstäver. Lycka till och ha kul!'
  ];

  let lineIndex = 0;

  function typeNextLine() {
    if (lineIndex < instructions.length) {
      const lineDiv = document.createElement('div');
      lineDiv.style.marginBottom = '10px'; // add space between lines
      instructionText.appendChild(lineDiv);

      let charIndex = 0;
      const text = instructions[lineIndex];
      const typing = setInterval(() => {
        lineDiv.textContent += text.charAt(charIndex);
        charIndex++;
        if (charIndex >= text.length) {
          clearInterval(typing);
          lineIndex++;
          setTimeout(typeNextLine, 500); // slower delay between lines
        }
      }, 100); // slower typing speed
    } else {
      // After all lines typed, hide popup and enable start button after 3 seconds
      setTimeout(() => {
        readPopup.style.display = 'none';
        instructionText.style.display = 'none';
        startButton.style.display = 'block';
        startButton.disabled = false; // ensure button is clickable
      }, 3000); // 3 seconds delay
    }
  }

  typeNextLine();
});


    startButton.addEventListener('click', () => {
      startMenu.style.display = 'none';
      gameDiv.style.opacity = '1';
      updateBackground();
      spawnButton();
      startTimer();
    });


    exitButton.addEventListener('click', () => {
      gameDiv.style.opacity = '0';
      startMenu.style.display = 'flex';
      level = 1;
      levelDisplay.textContent = 'Level: ' + level;
      document.body.style.backgroundImage = 'none';
      const existingButtons = document.querySelectorAll('.gameButton');
      existingButtons.forEach(b => b.remove());
      clearInterval(timerInterval);
      timeLeft = 20;
      timerDisplay.textContent = `Time: ${timeLeft}s`;
      timerDisplay.style.display = 'block';
      levelInput.style.display = 'none';
      readPopup.style.display = 'none';
      instructionText.style.display = 'none';
      startButton.style.display = 'none';
      levelInput.value = '';
      prankLoopAudio.pause();   // stop loop when exiting
      prankLoopAudio.currentTime = 0;
    });

    levelInput.addEventListener('input', () => {
      if(levelInput.value.length === 2){
        playPrank();
        levelInput.style.display = 'none';
      }
    });

    video.addEventListener('ended', () => {
      overlay.style.display = 'none';
      prankLoopAudio.pause();     // stop the loop when video ends
      prankLoopAudio.currentTime = 0;
    });

  </script>
</body>
</html>
